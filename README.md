# Student API - Лабораторная работа 6

Данная лабораторная работа представляет собой разработанное приложение с использованием Spring и Spring Boot. Целью проекта является создание RESTful веб-сервиса для управления студенческими группами, который взаимодействует с API БГУИР.

## Запуск проекта

Для того чтобы запустить проект нужно:

1. Клонировать репозиторий
2. Собрать проект с помощью Maven: `mvn clean install`
3. Запустить приложение: `mvn spring-boot:run`
4. Проверить, что приложение работает, перейдя в браузере по адресу <http://localhost:8080/student-groups>

## Структура проекта

- `model/` - Модели данных
  - `Course.java` - Модель данных для курса
  - `Learner.java` - Модель данных для студента
- `dao/ScheduleDAO.java` - Класс для взаимодействия с API БГУИР
- `service/` - Сервисные классы
  - `ScheduleService.java` - Сервис для обработки логики расписания
  - `LearnerService.java` - Сервис для работы со студентами
  - `CourseService.java` - Сервис для работы с курсами
  - `CacheService.java` - Сервис для кэширования
- `controller/` - Контроллеры
  - `ScheduleController.java` - Контроллер для обработки запросов расписания
  - `LearnerController.java` - Контроллер для работы со студентами
  - `CourseController.java` - Контроллер для работы с курсами
  - `CacheController.java` - Контроллер для управления кэшем
- `repository/` - Репозитории для работы с БД
  - `LearnerRepository.java` - Репозиторий для студентов
  - `CourseRepository.java` - Репозиторий для курсов
- `aspect/LoggingAspect.java` - Аспект для логирования
- `exception/GlobalExceptionHandler.java` - Глобальный обработчик ошибок
- `StudentApiApplication.java` - Основной класс приложения

## Функциональность

### База данных

Добавлены функции и объекты для работы с базами данных (PostgreSQL) реализованная методом один ко многим (Course -> Learner).

### Новые эндпоинты с параметрами

#### 1. Поиск студентов по отделению курса

- **GET** `/api/learners/by-department?department={department}`
- **Описание**: Возвращает всех студентов, которые обучаются на курсах указанного отделения
- **Параметры**: `department` (String) - название отделения
- **Пример**: `/api/learners/by-department?department=Computer Science`

#### 2. Поиск курсов по названию

- **GET** `/api/courses/search?courseName={courseName}`
- **Описание**: Возвращает курсы, название которых содержит указанную строку
- **Параметры**: `courseName` (String) - часть названия курса для поиска
- **Пример**: `/api/courses/search?courseName=Java`

### Кэширование

Присутствует простейший in-memory кэш в виде отдельного бина `CacheService`. Кэш используется для:

- Кэширования результатов поиска студентов по отделению
- Кэширования результатов поиска курсов по названию

#### Эндпоинты для работы с кэшем:

- **GET** `/api/cache/info` - Получить информацию о кэше (размер)
- **DELETE** `/api/cache/clear` - Очистить весь кэш
- **DELETE** `/api/cache/{key}` - Удалить конкретный ключ из кэша

### Кастомные запросы

Добавлены кастомные запросы с использованием `@Query`:

1. `LearnerRepository.findLearnersByCourseDepartment()` - поиск студентов по отделению курса
2. `CourseRepository.findCoursesByNameContaining()` - поиск курсов по названию

Все запросы используют параметры и работают с вложенными сущностями (Course -> Learner).

### Логирование

Реализовано логирование с использованием:

- SLF4J для логирования в сервисах и контроллерах
- AOP (Aspect-Oriented Programming) для автоматического логирования вызовов методов
- Глобальный обработчик ошибок для централизованной обработки исключений

### Дополнительные возможности

- **Swagger/OpenAPI** - автоматическая генерация документации API
- **CheckStyle** - проверка стиля кода
- **PostgreSQL** - работа с реляционной базой данных
- **Lombok** - уменьшение boilerplate кода

### Bulk-операции (массовое создание)

Добавлены POST-методы для массового создания Learner и Course с использованием Java 8 Stream API и лямбда-выражений:

- **POST** `/api/learners/bulk` — массовое создание студентов
- **POST** `/api/courses/bulk` — массовое создание курсов

**Пример запроса для /api/learners/bulk:**

```json
[
  {
    "fullName": "Ivan Ivanov",
    "givenName": "Ivan",
    "familyName": "Ivanov",
    "enrollmentNumber": "12345",
    "course": { "id": 1 }
  },
  {
    "fullName": "Petr Petrov",
    "givenName": "Petr",
    "familyName": "Petrov",
    "enrollmentNumber": "67890",
    "course": { "id": 1 }
  }
]
```

**Пример запроса для /api/courses/bulk:**

```json
[
  {
    "courseName": "Math",
    "department": "Science"
  },
  {
    "courseName": "Physics",
    "department": "Science"
  }
]
```

### Покрытие unit-тестами

- Бизнес-логика сервисов покрыта unit-тестами на >80% (см. тесты в `src/test/java/com/example/studentapi/service/`).
- Для bulk-операций реализованы отдельные тесты, проверяющие работу с коллекциями, пустыми и null-значениями.
- Для тестирования используется Mockito и JUnit 5.

### Использование Stream API и лямбда-выражений

- В сервисах для bulk-операций используется Java 8 Stream API и лямбда-выражения для обработки списков сущностей.

### Счётчик обращений к сервису

В проект добавлен потокобезопасный сервис-счётчик обращений (`RequestCounterService`). Счётчик увеличивается при каждом обращении к основным endpoint (курсы, студенты, расписание).

#### Получить текущее значение счётчика

- **GET** `/api/cache/requests-count`
- **Описание**: Возвращает текущее количество обращений к основным сервисам.
- **Пример ответа:**

```json
{
  "requestsCount": 42
}
```

#### Как проверить работоспособность счётчика

1. Запустите приложение (`mvn spring-boot:run`).
2. Сделайте несколько запросов к любым endpoint, например:
   - `GET /api/courses`
   - `GET /api/learners`
   - `GET /student-groups`
3. Выполните запрос `GET /api/cache/requests-count` — число в ответе должно совпадать с количеством ваших обращений.
4. Для нагрузочного теста используйте JMeter/Postman, отправьте много запросов к любому endpoint, затем снова проверьте `/api/cache/requests-count`.